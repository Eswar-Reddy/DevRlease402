var timeoutmethod="";var fieldNameElementArray={};var fieldNameValueArray={};var findStreetDataStore=[];var findFirstNameDataStore=[];var findLastNameDataStore=[];var findPostalCodeDataStore=[];var findCityDataStore=[];var organizationNameDataStore=[];var replacedText=" ";var replacTextNameArr=[];var replacTextValueArr=[];var translated_states={france:{"Alpes-De-Haute-Provence":"Alpes (Hte-Provence)","Haute-Alpes":"Alpes (Hautes)","Côte-D'or":"Côte-d'Or","Eure-Et-Loir":"Eure-et-Loir","Haute-Garonne":"Garonne (Haute)","Ille-Et-Vilaine":"Ille-et-Vilaine","Indre-Et-Loire":"Indre-et-Loire","Loir-Et-Cher":"Loir-et-Cher","Haute-Loire":"Loire (Haute)","Lot-Et-Garonne":"Lot-et-Garonne","Maine-Et-Loire":"Maine-et-Loire","Haute-Marne":"Marne (Haute)","Meurthe-Et-Moselle":"Meurthe-et-Moselle","Pas-De-Calais":"Pas-de-Calais","Puy-De-Dôme":"Puy-de-Dôme","Haute-Pyrénées":"Pyrénées (Hautes)","Haute-Saône":"Saône (Haute)","Saône-Et-Loire":"Saône-et-Loire","Haute-Savoie":"Savoie (Haute)","Seine-Et-Marne":"Seine-et-Marne","Deux-Sèvres":"Sèvres (Deux)","Tarn-Et-Garonne":"Tarn-et-Garonne","Haute-Vienne":"Vienne (Haute)"}};var ADDRESS_AUTOCOMPLETE_METHOD="/addressAutocomplete";var GET_FIRST_NAMES_METHOD="/getFirstNames";var GET_LAST_NAMES_METHOD="/getLastNames";var GET_FIELD_AUTOCOMPLETE_METHOD="/fieldAutoComplete";var formName="Account Search";var schema="ad_dqplus__";var namespace="ad_dqplus";var lookupPages=new Array("Account");var _formPageForLookup="editPage";var fieldToGroupMap={};var fieldToAddressWizardMap={};var addressWizardToFieldsMap={};var fieldToSettingMap={};var dqplusWebserviceUsername="";var dqplusWebservicePassword="";var dqplusWebserviceURL="";var MinimumNumberOfCharactersEnteredToTriggerZIPCodeLookup=3;var MaximumNumberOfValuesToDisplayZIPCodeMenu=5;var labelToFieldMap={City__c:"City",Country__c:"Country",Street__c:"Street",StateProvince__c:"State/Province",ZipCode__c:"Zip Code"};var streetAutocompleteListMaxSize=10;var isAutocompleteListForCountryReady=false;var USAonly=false;var dqplus={};var _instance_url;var _sfConn;var _angular_scope;dqplus.init=function(b,a,c){_sfConn=a;if(b&&a){if(!b.connection.sessionId){b.connection.sessionId=_sfConn.accessToken}}if(c){_angular_scope=c;if(c.conn){_sfConn=c.conn}if($==undefined){jQuery.noConflict(true)}}this.saveFieldGroupConfigurations();this.getFieldSettingConfig();this.saveDQWSconfiguration(b);populatefields()};dqplus.logAutoCompleteEvent=function(b){if(b&&b.item){var c=new sforce.SObject("Address_autocomplete_API_usage__c");c.Address__c=b.item.label;c.Country__c=b.item.value.Country;c.Country_Code__c=b.item.value.CountryCode;sforce.connection.create([c],{onSuccess:d,onFailure:a});function d(e){if(!e[0].getBoolean("success")){console.log("failed to create logEntry "+e[0])}}function a(e){console.log("An error has occurred "+e)}}};dqplus.saveFieldGroupConfigurations=function(){var c={onSuccess:a,onFailure:b};function a(d){try{d=d.records;if(d.length>0){for(i=0;i<d.length;i++){fieldToGroupMap[d[i][schema+"FieldAPIName__c"]]={fieldGroup:d[i][schema+"FieldGroup__c"],formName:d[i][schema+"FormName__c"],groupType:d[i][schema+"GroupType__c"]};fieldToAddressWizardMap[d[i][schema+"FieldAPIName__c"]]=d[i][schema+"FieldGroup__c"];if((addressWizardToFieldsMap[d[i][schema+"FieldGroup__c"]]==null)||(typeof addressWizardToFieldsMap[d[i][schema+"FieldGroup__c"]]=="undefined")){addressWizardToFieldsMap[d[i][schema+"FieldGroup__c"]]={}}addressWizardToFieldsMap[d[i][schema+"FieldGroup__c"]][d[i][schema+"DQPlusDatatype__c"].toLowerCase()]=[d[i][schema+"FieldAPIName__c"]]}}}catch(f){console.error(f)}}function b(d){console.error(d)}sforce.connection.query(fgQuery,c)};dqplus.saveDQWSconfiguration=function(a){var b={onSuccess:function(c){dqplusWebserviceUsername=c[0].ad_dqplus__DQ_Plus_Web_Service_User_Name__c;dqplusWebserviceURL=c[0].ad_dqplus__DQ_Plus_Remote_Site_URL__c;dqplusWebservicePassword=c[0].ad_dqplus__DQ_Plus_Web_Service_Password__c},onFailure:function(c){console.warn(c)}};a.apex.execute("ad_dqplus.WebServicesSettingController","getWebServiceActiveConfiguration",{},b)};dqplus.getFieldSettingConfig=function(){var c={onSuccess:a,onFailure:b};function a(d){try{if(d.records.length>0){for(i=0;i<d.records.length;i++){fieldToSettingMap[d.records[i][schema+"FieldAPIName__c"]]={dataType:dqplus.lowerCase(d.records[i][schema+"DQPlusDatatype__c"]),smartTab:dqplus.lowerCase(d.records[i][schema+"SmartSearchOnTab__c"]),formName:dqplus.lowerCase(d.records[i][schema+"FormName__c"]),cleanse:dqplus.lowerCase(d.records[i][schema+"Cleanse__c"]),dataSourceConnectorName:d.records[i][schema+"Data_Source_Connector_Name__c"],ruleSetName:d.records[i][schema+"Rule_Set_Name__c"],searchAndReplaceRuleSubsetName:d.records[i][schema+"SearchAndReplaceRuleSubsetName__c"],correctionAndStandarizationRuleSubsetName:d.records[i][schema+"Correction_Standardization_Subset_Name__c"],duplicateIDRuleSubsetName:d.records[i][schema+"DuplicateIDRuleSubsetName__c"]}}}}catch(f){console.error(f)}}function b(d){console.error(d)}sforce.connection.query(fsQuery,c)};_country_states={};dqplus.getCountryFromScope=function(){var a=getBillingCountryInputItem();if(a){country_id=document.getElementById(a.id+"_lkid").value;return country_id}};dqplus.getStatesFromCountry=function(){var d=this.getCountryFromScope();var b="select id,Name,StateProvinceCode__c from StateProvince__c where Country__c='"+d+"' order by Name";result=sforce.connection.query(b);records=result.getArray("records");for(var a=0;a<records.length;a++){try{country_states_array=new Array();if(result.records&&result.records.length>0){for(a=0;a<result.records.length;a++){state={id:result.records[a]["Id"],name:result.records[a]["Name"],code:result.records[a]["StateProvinceCode__c"]};country_states_array.push(state)}_country_states[getBillingCountryInputItemValue()]=country_states_array}}catch(c){console.error(c)}}};var fgQuery="select id,ad_dqplus__FieldAPIName__c,ad_dqplus__FormName__c,ad_dqplus__DQPlusDatatype__c,ad_dqplus__GroupType__c,ad_dqplus__FieldGroup__c  from ad_dqplus__FieldGroup__c where ad_dqplus__formname__c = '"+formName+"'order by ad_dqplus__FieldGroup__c ";var fsQuery="SELECT Id, "+schema+"Cleanse__c, "+schema+"Correction_Standardization_Subset_Name__c, "+schema+"DQPlusDatatype__c, "+schema+"FieldAPIName__c, "+schema+"FormName__c, "+schema+"SmartSearchOnTab__c, "+schema+"SearchAndReplaceRuleSubsetName__c, "+schema+"Data_Source_Connector_Name__c, "+schema+"Rule_Set_Name__c, "+schema+"DuplicateIDRuleSubsetName__c FROM "+schema+"FieldSetting__c where  "+schema+"FormName__c= '"+formName+"'";dqplus.fieldSettingConfCallback={onSuccess:this.saveFieldSettingConf,onFailure:this.handleFailure};dqplus.handleFailure=function(a){console.warn(a)};dqplus.lowerCase=function(a){return a!=undefined?a.toLowerCase():""};function displaySuggestionPanelForCityInput(g,d,f,b){var h=getHostFromUrl(dqplusWebserviceURL);var c=h+ADDRESS_AUTOCOMPLETE_METHOD+"?callback=?";var e='<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:web="http://webservices.acmedata.net/"><soapenv:Header/><soapenv:Body><web:findCityStateInternational></web:findCityStateInternational></soapenv:Body></soapenv:Envelope>';var j=getXMLDocument(e);if(j.getElementsByTagNameNS==undefined){var a=j.getElementsByTagName("web:findCityStateInternational")[0]}else{var a=j.getElementsByTagNameNS("http://webservices.acmedata.net/","findCityStateInternational")[0]}newNode=j.createElement("maxrecords");newNodeText=j.createTextNode("10");newNode.appendChild(newNodeText);a.appendChild(newNode);newNode=j.createElement("locality");newNodeText=j.createTextNode(f);newNode.appendChild(newNodeText);a.appendChild(newNode);newNode=j.createElement("country");newNodeText=j.createTextNode(d);newNode.appendChild(newNodeText);a.appendChild(newNode);newNode=j.createElement("postalcode");newNodeText=j.createTextNode(b);newNode.appendChild(newNodeText);a.appendChild(newNode);$(g).autocomplete({disabled:true});webserviceCall(j,findCityAutoCompleteCallback,g)}function findCityAutoCompleteCallback(d,f){var b=getFieldName(f);var e;var c=[];if(window.DOMParser){parser=new DOMParser();e=parser.parseFromString(d,"text/xml")}else{e=new ActiveXObject("Microsoft.XMLDOM");e.async=false;e.loadXML(d)}if(e.getElementsByTagName("return")[0].childNodes.length>0){findCityDataStore=[];$(e.getElementsByTagName("cityStateRecordFound")).each(function(){var g={};if($(this).find("city").text()!=""){findCityDataStore.push(toTitleCase($(this).find("city").text()));g.label=$(this).find("city").text();g.value=$(this).find("state").text();c.push(g)}});if(c.length>0){$(f).autocomplete({source:c,minLength:3,mustMatch:false,matchContains:true,select:function(g,h){getBillingStateInputItem().value=h.item.value;$(this).val(h.item.label);return false}});var a=$(f).autocomplete("option","disabled");if(a){$(f).autocomplete({disabled:false})}$(f).autocomplete("search")}}}function displaySuggestionPanelForFieldAutoCompleteInput(g,b,e,h,f){var d=getHostFromUrl(dqplusWebserviceURL);var c=d+GET_FIELD_AUTOCOMPLETE_METHOD+"?callback=?";$(g).autocomplete({source:function(k,j){$.getJSON(c,{outputFormat:"json",format:"jsonp",dataSourceConnector:b,dataObject:e,fieldName:h,fieldValue:f,maximumValuesReturned:10},function(l){j($.map(l.fieldValuesList.fieldValue,function(m){return{label:m,value:m}}))})},minLength:3,mustMatch:false,matchContains:true,select:function(j,k){setFieldValue("accountname",k.item.value);if(_angular_scope!=undefined){_angular_scope.$digest()}return false}});var a=$(g).autocomplete("option","disabled");if(a){$(g).autocomplete({disabled:false})}$(g).autocomplete("search")}function displaySuggestionPanelForLastNameInput(e,c){var d=getHostFromUrl(dqplusWebserviceURL);var b=d+GET_LAST_NAMES_METHOD+"?callback=?";$(e).autocomplete({source:function(g,f){$.getJSON(b,{format:"jsonp",lastNameText:c,maxrecords:10},function(h){f($.map(h.lastNamesList.lastName,function(j){return{label:j,value:j}}))})},minLength:3,mustMatch:false,matchContains:true,select:function(f,g){setFieldValue("lastname",g.item.value);if(_angular_scope!=undefined){_angular_scope.$digest()}return false}});var a=$(e).autocomplete("option","disabled");if(a){$(e).autocomplete({disabled:false})}$(e).autocomplete("search")}function displaySuggestionPanelForFirstNameInput(e,d){var c=getHostFromUrl(dqplusWebserviceURL);var b=c+GET_FIRST_NAMES_METHOD+"?callback=?";$(e).autocomplete({source:function(g,f){$.getJSON(b,{format:"jsonp",firstNameText:d,maxrecords:10},function(h){f($.map(h.firstNamesList.firstNames,function(j){return{label:j,value:j}}))})},minLength:3,mustMatch:false,matchContains:true,select:function(f,g){setFieldValue("firstname",g.item.value);if(_angular_scope!=undefined){_angular_scope.$digest()}return false}});var a=$(e).autocomplete("option","disabled");if(a){$(e).autocomplete({disabled:false})}$(e).autocomplete("search")}function displaySuggestionPanelForBillingStreetInput(g,j,k,e,b,d,h,m){var f=getHostFromUrl(dqplusWebserviceURL);var a=f+ADDRESS_AUTOCOMPLETE_METHOD+"?callback=?";var c=h?"asEntered":"latin";$(g).autocomplete({source:function(o,n){$.getJSON(a,{format:"jsonp",address1:j,postalcode:k,city:e,state:b,country:d,returnAlphabet:c,maxrecords:streetAutocompleteListMaxSize},function(p){n($.map(p.Results.Address,function(q){return{label:q.Address,value:q}}))})},delay:200,minLength:3,mustMatch:false,matchContains:true,select:function(n,p){if(m=="address line 2"){getBillingLocalCityInputItem().value=p.item.value.City;$(this).val(p.item.value.Street);findExactStreetFromLocalStreet(g,true,"address line 2")}else{var o=p.item.value.State;if(o.length==2){o=dqplus.setLongNameState(o,d)}setFieldValue("state",o);setFieldValue("zip",p.item.value.ZipCode);setFieldValue("city",p.item.value.City);setFieldValue("street",p.item.value.Street);if(_angular_scope!=undefined){_angular_scope.$digest()}dqplus.logAutoCompleteEvent(p)}return false}});var l=$(g).autocomplete("option","disabled");if(l){$(g).autocomplete({disabled:false})}}function getBillingCountryInputItemValue(){var a=getBillingCountryInputItem();if(a.tagName.toLowerCase()=="select"){return $(getBillingCountryInputItem()).find(":selected").text()}else{return a.value}}function getBillingStateInputItemValue(){var a=getBillingStateInputItem();if(a.tagName.toLowerCase()=="select"){return $(getBillingCountryInputItem()).find(":selected").text()}else{return a.value}}function getBillingCityInputItem(){var a="city";var b=getFieldNameByDataType(a);return fieldNameElementArray[addressWizardToFieldsMap[fieldToAddressWizardMap[b]][a]]}function getBillingStateInputItem(){var a="state or province";var b=getFieldNameByDataType(a);return fieldNameElementArray[addressWizardToFieldsMap[fieldToAddressWizardMap[b]][a]]}function getBillingPostalcodeInputItem(){var a="zip or postal code";var b=getFieldNameByDataType(a);return fieldNameElementArray[addressWizardToFieldsMap[fieldToAddressWizardMap[b]][a]]}function getBillingCountryInputItem(){var a="country";var b=getFieldNameByDataType(a);if(b===""){return""}return fieldNameElementArray[addressWizardToFieldsMap[fieldToAddressWizardMap[b]][a]]}function getBillingStreetInputItem(){var a="address line 1";var b=getFieldNameByDataType(a);return fieldNameElementArray[addressWizardToFieldsMap[fieldToAddressWizardMap[b]][a]]}function getBillingLocalStreetInputItem(){var a="address line 2";var b=getFieldNameByDataType(a);return fieldNameElementArray[addressWizardToFieldsMap[fieldToAddressWizardMap[b]][a]]}function getBillingLocalCityInputItem(){var a="address line 3";var b=getFieldNameByDataType(a);return fieldNameElementArray[addressWizardToFieldsMap[fieldToAddressWizardMap[b]][a]]}function getFirstNameInputItem(){var a="first name";var b=getFieldNameByDataType(a);return fieldNameElementArray[addressWizardToFieldsMap[fieldToAddressWizardMap[b]][a]]}function getLastNameInputItem(){var a="last name";var b=getFieldNameByDataType(a);return fieldNameElementArray[addressWizardToFieldsMap[fieldToAddressWizardMap[b]][a]]}function getAccountNameInputItem(){var a="organization name";var b=getFieldNameByDataType(a);return fieldNameElementArray[addressWizardToFieldsMap[fieldToAddressWizardMap[b]][a]]}function findFirstName(b){if(timeoutmethod!=""){clearTimeout(timeoutmethod)}var a=b.value;displaySuggestionPanelForFirstNameInput(b,a)}function findAccountName(b){if(timeoutmethod!=""){clearTimeout(timeoutmethod)}var a=b.value;var d=getFieldNameByDataType("organization name");var c=fieldToSettingMap[d].dataSourceConnectorName;displaySuggestionPanelForFieldAutoCompleteInput(b,"Salesforce.com - Schneider Full Sandbox","Account","Name",a)}function findLastName(b){if(timeoutmethod!=""){clearTimeout(timeoutmethod)}var a=b.value;displaySuggestionPanelForLastNameInput(b,a)}function findStreet(d,b,h){if(timeoutmethod!=""){clearTimeout(timeoutmethod)}var g=d.value;var a=getBillingPostalcodeInputItem().value;var f=getBillingCityInputItem().value;var c=dqplus.getInputValue(getBillingStateInputItem());var e=dqplus.getInputValue(getBillingCountryInputItem());displaySuggestionPanelForBillingStreetInput(d,g,a,f,c,e,b,h)}function findExactStreetFromLocalStreet(f,e,h){var d=getBillingLocalStreetInputItem().value;var a=getBillingLocalCityInputItem().value;var g=dqplus.getInputValue(getBillingCountryInputItem());var c=getHostFromUrl(dqplusWebserviceURL);var b=c+ADDRESS_AUTOCOMPLETE_METHOD+"?callback=?";$.getJSON(b,{format:"jsonp",address1:d,country:g,city:a,returnAlphabet:"latin",maxrecords:1},function(j){if(j.Results.Address[0]){if("City" in j.Results.Address[0]){getBillingCityInputItem().value=j.Results.Address[0].City}if("State" in j.Results.Address[0]){getBillingStateInputItem().value=j.Results.Address[0].State}if("ZipCode" in j.Results.Address[0]){getBillingPostalcodeInputItem().value=j.Results.Address[0].ZipCode}if("Street" in j.Results.Address[0]){getBillingStreetInputItem().value=j.Results.Address[0].Street}}})}function findCityByAutoComplete(b){if(timeoutmethod!=""){clearTimeout(timeoutmethod)}var d=b.value;var a=getBillingPostalcodeInputItem().value;var c=dqplus.getInputValue(getBillingCountryInputItem());displaySuggestionPanelForCityInput(b,c,d,a)}function getHostFromUrl(b){if(typeof b!="undefined"&&b.trim()!=""){b=b.trim();var c="";var a;var d;a=b.indexOf("//");if(a<0){b="https://"+b;a=b.indexOf("//")}d=b.indexOf("/",a+2);if(d<0){d=b.legth}c=b.substring(0,d);return c}else{alert("DQ*Plus Remote host setting");return""}}function toTitleCase(f){var b=f;var e=b.split(" ");var a="";for(var c=0;c<e.length;c++){try{a+=e[c][0].toUpperCase()}catch(d){}a+=e[c].substring(1,e[c].length).toLowerCase();a+=" "}return a.substring(0,a.length-1)}function displaySuggestionPanel(c,b){$(c).autocomplete({source:b,minLength:0,mustMatch:false,matchContains:true,select:function(d,e){onMenuSelect(c,e)}});var a=$(c).autocomplete("option","disabled");if(a){$(c).autocomplete({disabled:false})}$(c).autocomplete("search")}function getFieldName(a){if(a.className.indexOf(" ")!=-1){return a.className.substring(0,a.className.indexOf(" "))}else{return a.className}}function onMenuSelect(h,g){var b=getFieldName(h);if(fieldToSettingMap[b].dataType=="zip or postal code"){var e='<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:web="http://webservices.acmedata.net/"><soapenv:Header/><soapenv:Body><web:findCityStateByPostalCode></web:findCityStateByPostalCode></soapenv:Body></soapenv:Envelope>';var f=getXMLDocument(e);if(f.getElementsByTagNameNS==undefined){var d=f.getElementsByTagName("web:findCityStateByPostalCode")[0]}else{var d=f.getElementsByTagNameNS("http://webservices.acmedata.net/","findCityStateByPostalCode")[0]}var c=f.createElement("userName");var a=f.createTextNode(dqplusWebserviceUsername);c.appendChild(a);d.appendChild(c);c=f.createElement("password");a=f.createTextNode(dqplusWebservicePassword);c.appendChild(a);d.appendChild(c);c=f.createElement("maximumRecordsReturned");a=f.createTextNode("5");c.appendChild(a);d.appendChild(c);c=f.createElement("postalCodeCriteria");a=f.createTextNode(g.item.label);c.appendChild(a);d.appendChild(c);c=f.createElement("countryCriteria");a=f.createTextNode("USA");c.appendChild(a);d.appendChild(c);$(h).autocomplete({disabled:true});webserviceCall(f,findStreetOnZipcodeResponseParser,h)}else{if(fieldToSettingMap[b].dataType=="city"){if(fieldNameElementArray[addressWizardToFieldsMap[fieldToAddressWizardMap[b]]["address line 1"]]!=null&&typeof(fieldNameElementArray[addressWizardToFieldsMap[fieldToAddressWizardMap[b]]["address line 1"]])!="undefined"){fieldNameElementArray[addressWizardToFieldsMap[fieldToAddressWizardMap[b]]["address line 1"]].focus()}}}}function webserviceCall(b,c,a){sforce.connection.remoteFunction({url:dqplusWebserviceURL,requestHeaders:{"Content-Type":"text/xml;charset=UTF-8",SOAPAction:'""'},requestData:b,method:"POST",timeout:10000,onSuccess:function(d){c(d,a)},onFailure:function(d){alert("An attempt to communicate with the DQ*Plus server failed.")}})}function findPostalcodeResponseParser(a,c){var b;if(window.DOMParser){parser=new DOMParser();b=parser.parseFromString(a,"text/xml")}else{b=new ActiveXObject("Microsoft.XMLDOM");b.async=false;b.loadXML(a)}if(b.getElementsByTagName("return")[0].childNodes.length>0){findPostalCodeDataStore=[];$(b.getElementsByTagName("postalCodesFound")[0]).children().each(function(){if($(this).text()!=null&&$(this).text()!=""){var d=$(this).text();if(jQuery.inArray(toTitleCase(d),findPostalCodeDataStore)==-1){findPostalCodeDataStore.push(toTitleCase(d))}}});if(findPostalCodeDataStore.length<=MaximumNumberOfValuesToDisplayZIPCodeMenu){findPostalCodeDataStore.sort();displaySuggestionPanel(c,findPostalCodeDataStore)}}}function findStreetOnZipcodeResponseParser(d,f){var a=getFieldName(f);var e;if(window.DOMParser){parser=new DOMParser();e=parser.parseFromString(d,"text/xml")}else{e=new ActiveXObject("Microsoft.XMLDOM");e.async=false;e.loadXML(d)}if(e.getElementsByTagName("return")[0].childNodes.length>0){findCityDataStore=[];$(e.getElementsByTagName("cityStateRecordFound")).each(function(){if($(this).find("state").text()!=""){fieldNameElementArray[addressWizardToFieldsMap[fieldToAddressWizardMap[a]]["state or province"]].value=$(this).find("state").text()}if($(this).find("city").text()!=""){findCityDataStore.push(toTitleCase($(this).find("city").text()))}});if(findCityDataStore.length==1){if(fieldToSettingMap[a].dataType=="zip or postal code"){var b=addressWizardToFieldsMap[fieldToAddressWizardMap[a]]["city"];fieldNameElementArray[b].value=findCityDataStore[0];var c=addressWizardToFieldsMap[fieldToAddressWizardMap[a]]["address line 1"];fieldNameElementArray[c].focus()}}else{if(findCityDataStore.length>1){var b=addressWizardToFieldsMap[fieldToAddressWizardMap[a]]["city"];fieldNameElementArray[b].value="";var c=addressWizardToFieldsMap[fieldToAddressWizardMap[a]]["address line 1"];fieldNameElementArray[c].value="";fieldNameElementArray[b].focus();displaySuggestionPanel(fieldNameElementArray[b],findCityDataStore)}}}}function getStreetRange(a){a=$.trim(a);a=getLeadingNumbers(a);a=$.trim(a);return a}function getLeadingNumbers(d){var c=d;var b=new String("");var a=0;while((c.charAt(a)>="0")&&(c.charAt(a)<="9")){b+=c.charAt(a);++a}return b}function getElementByIdName(c){var b=document.getElementsByTagName("input");for(var a=0;a<b.length;a++){if(b[a].className.indexOf(c)==0){return b[a]}}}function getEnvelope(f,g,d){var b='<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:web="http://webservices.acmedata.net/"><soapenv:Header/><soapenv:Body></soapenv:Body></soapenv:Envelope>';var j=getXMLDocument(b);if(j.getElementsByTagNameNS==undefined){var a=j.getElementsByTagName("soapenv:Body")[0]}else{var a=j.getElementsByTagNameNS("http://schemas.xmlsoap.org/soap/envelope/","Body")[0]}var e=j.createElement("web:"+d);a.appendChild(e);var h=j.createElement("userName");var c=j.createTextNode(dqplusWebserviceUsername);h.appendChild(c);e.appendChild(h);h=j.createElement("password");c=j.createTextNode(dqplusWebservicePassword);h.appendChild(c);e.appendChild(h);h=j.createElement("maximumStreetsReturned");c=j.createTextNode("10");h.appendChild(c);e.appendChild(h);for(index=0;index<f;index++){h=j.createElement(f[index]);c=j.createTextNode(g[index]);h.appendChild(c);e.appendChild(h)}return j}function getFieldValueMapEnvelope(j,a,g,k,e){var c='<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:web="http://webservices.acmedata.net/"><soapenv:Header/><soapenv:Body></soapenv:Body></soapenv:Envelope>';var n=getXMLDocument(c);if(n.getElementsByTagNameNS==undefined){var b=n.getElementsByTagName("soapenv:Body")[0]}else{var b=n.getElementsByTagNameNS("http://schemas.xmlsoap.org/soap/envelope/","Body")[0]}var h=n.createElement("web:"+g);b.appendChild(h);var l=n.createElement("userName");var f=n.createTextNode(dqplusWebserviceUsername);l.appendChild(f);h.appendChild(l);l=n.createElement("password");f=n.createTextNode(dqplusWebservicePassword);l.appendChild(f);h.appendChild(l);if(typeof(j.searchAndReplaceRuleSubsetName)!="undefined"&&j.searchAndReplaceRuleSubsetName!=null&&j.searchAndReplaceRuleSubsetName!=""){l=n.createElement("searchAndReplaceRuleSubsetName");f=n.createTextNode(HTMLDecode(j.searchAndReplaceRuleSubsetName));l.appendChild(f);h.appendChild(l)}if(typeof(j.correctionAndStandarizationRuleSubsetName)!="undefined"&&j.correctionAndStandarizationRuleSubsetName!=null&&j.correctionAndStandarizationRuleSubsetName!=""){l=n.createElement("correctionAndStandarizationRuleSubsetName");f=n.createTextNode(HTMLDecode(j.correctionAndStandarizationRuleSubsetName));l.appendChild(f);h.appendChild(l)}for(index in a){l=n.createElement(index);f=n.createTextNode(a[index]);l.appendChild(f);h.appendChild(l)}var d=n.createElement(k);h.appendChild(d);for(index in j){if(index!="searchAndReplaceRuleSubsetName"&&index!="correctionAndStandarizationRuleSubsetName"&&index!="headervalue"&&j[index]!=""||index=="BO_NAME"){var m=n.createElement("fieldValueSet");d.appendChild(m);l=n.createElement("field");f=n.createTextNode(index);l.appendChild(f);m.appendChild(l);l=n.createElement("value");f=n.createTextNode(j[index]);l.appendChild(f);m.appendChild(l)}}return n}function getDupFieldValueMapEnvelope(m,a,f,h){var c='<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:web="http://webservices.acmedata.net/"><soapenv:Header/><soapenv:Body></soapenv:Body></soapenv:Envelope>';var l=getXMLDocument(c);if(l.getElementsByTagNameNS==undefined){var b=l.getElementsByTagName("soapenv:Body")[0]}else{var b=l.getElementsByTagNameNS("http://schemas.xmlsoap.org/soap/envelope/","Body")[0]}var g=l.createElement("web:"+f);b.appendChild(g);var j=l.createElement("userName");var e=l.createTextNode(dqplusWebserviceUsername);j.appendChild(e);g.appendChild(j);j=l.createElement("password");e=l.createTextNode(dqplusWebservicePassword);j.appendChild(e);g.appendChild(j);for(index in a){j=l.createElement(index);e=l.createTextNode(a[index]);j.appendChild(e);g.appendChild(j)}var d=l.createElement(h);g.appendChild(d);for(index in m){var k=l.createElement("fieldValueSet");d.appendChild(k);j=l.createElement("value");e=l.createTextNode(m[index]);j.appendChild(e);k.appendChild(j);if(strEndsWith(index,"__c")){index=index.substring(0,index.length-3)}j=l.createElement("field");e=l.createTextNode(index);j.appendChild(e);k.appendChild(j)}return l}function clearform(){clearrec();var a=document.getElementById(formEleName);for(i=0;i<a.length;i++){field_type=a[i].type.toLowerCase();switch(field_type){case"text":a[i].value="";case"textarea":a[i].value=""}}findStreetDataStore=[];findCityDataStore=[];replacedText="";$("#errormessageid").html("");$("#errormessageid2").html("")}function scope_validation(){if(typeof(angular)!="undefined"){var a=angular.element($(".main")).scope();if(a){_angular_scope=a}}}var __scope_validated=false;_selected_country="";function onkeyuphandler(g,f){var b=getFieldName(g);var c=dqplus.getInputValue(getBillingCountryInputItem());if(!__scope_validated){__scope_validated=true;scope_validation()}if(c!=undefined&&c.trim()!=""){$(g).autocomplete({disabled:true});var e=isCountryUSA(c);if(!USAonly||(USAonly&&e)){if(getBillingStateInputItem().parentNode.className.toLowerCase()=="lookupinput"){if(!_country_states[c]){dqplus.getStatesFromCountry()}}if(fieldToSettingMap[b].dataType=="address line 1"){findStreetDataStore=[];replacedText=" ";var d=false;findStreet(g,d,"address line 1")}else{if(fieldToSettingMap[b].dataType=="address line 2"){findStreetDataStore=[];replacedText=" ";findStreet(g,true,"address line 2")}else{if(fieldToSettingMap[b].dataType=="city"){if(g.value.length>2){findCityByAutoComplete(g)}}else{if(fieldToSettingMap[b].dataType=="zip or postal code"){var a=g.value;if(a.length>=MinimumNumberOfCharactersEnteredToTriggerZIPCodeLookup){findPostalcode(g)}}}}}}}if(fieldToSettingMap[b].dataType=="first name"){findFirstNameDataStore=[];replacedText=" ";findFirstName(g)}else{if(fieldToSettingMap[b].dataType=="last name"){findLastNameDataStore=[];replacedText=" ";findLastName(g)}else{if(fieldToSettingMap[b].dataType=="organization name"){organizationNameDataStore=[];replacedText=" ";findAccountName(g)}}}}var lookup_countries=["usa","us","united states"];function isCountryUSA(a){return $.inArray(a.toLowerCase(),lookup_countries)!=-1}function onTaboutHandler(g,f){if(fieldToSettingMap[f].dataType=="zip or postal code"){var d;var c='<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:web="http://webservices.acmedata.net/"><soapenv:Header/><soapenv:Body><web:findCityStateByPostalCode></web:findCityStateByPostalCode></soapenv:Body></soapenv:Envelope>';var e=getXMLDocument(c);if(e.getElementsByTagNameNS==undefined){var d;var d=e.getElementsByTagName("web:findCityStateByPostalCode")[0]}else{var d=e.getElementsByTagNameNS("http://webservices.acmedata.net/","findCityStateByPostalCode")[0]}var b=e.createElement("userName");var a=e.createTextNode(dqplusWebserviceUsername);b.appendChild(a);d.appendChild(b);b=e.createElement("password");a=e.createTextNode(dqplusWebservicePassword);b.appendChild(a);d.appendChild(b);b=e.createElement("maximumRecordsReturned");a=e.createTextNode("5");b.appendChild(a);d.appendChild(b);b=e.createElement("postalCodeCriteria");a=e.createTextNode(g.value);b.appendChild(a);d.appendChild(b);b=e.createElement("countryCriteria");a=e.createTextNode("USA");b.appendChild(a);d.appendChild(b);webserviceCall(e,findStreetOnZipcodeResponseParser,g)}else{if(fieldToSettingMap[f].dataType=="first name"||fieldToSettingMap[f].dataType=="last name"){findDuplicates(g,f)}}}var range="";function makeFindStreetCall(f,g){if(g==null){$(f).autocomplete({source:findStreetDataStore});$(f).autocomplete("option");return}var b=getFieldName(f);var e=addressWizardToFieldsMap[fieldToAddressWizardMap[b]]["zip or postal code"];var j=fieldNameElementArray[e].value;var c=fieldNameElementArray[addressWizardToFieldsMap[fieldToAddressWizardMap[b]]["country"]].value;var d=fieldNameElementArray[addressWizardToFieldsMap[fieldToAddressWizardMap[b]]["state or province"]].value;var a=fieldNameElementArray[addressWizardToFieldsMap[fieldToAddressWizardMap[b]]["city"]].value;var l=["true",range,g,a,d,j,c];var k=["limitSearchToPostalCode","streetNumber","streetName","city","state","postalCode","country"];var h=getEnvelope(k,l,"findStreet");webserviceCall(h,findStreetResponseParser,f)}function findPostalcode(d){var e=d.value;if(e==null){$(d).autocomplete("option",{source:findPostalCodeDataStore});return}var b=[e,"USA"];var a=["postalCodeCriteria","countryCriteria"];var c=getEnvelope(a,b,"findPostalCodes");webserviceCall(c,findPostalcodeResponseParser,d)}function cleanse(){removeMessageDiv();removeErrorMessageId2Div();makeCleanseCall()}function populatefields(){if(document.getElementById("errormessageid2")!=null&&typeof(document.getElementById("errormessageid2"))!="undefined"){document.getElementById("errormessageid2").style.fontWeight="normal"}var e=Array.prototype.slice.call(document.getElementsByTagName("input")),c=Array.prototype.slice.call(document.getElementsByTagName("textarea"));s=Array.prototype.slice.call(document.getElementsByTagName("select"));var g=e.concat(c).concat(s);for(var f=0;f<g.length;f++){if((g[f].type=="text"||g[f].type=="textarea"||g[f].tagName.toLowerCase()=="select")&&g[f].className!=null&&typeof(g[f].className)!="undefined"){var d="";var h=g[f].className;if(h.indexOf(" ")!=-1){d=h.substring(0,h.indexOf(" "))}else{d=h}if($.trim(d)!=""){fieldNameElementArray[d]=g[f]}}}}function validateonKeyDownUserInput(f,d){d=(d||this);f=f||event;if(!f||f.charCode==0){return true}var c=window.event?event:f;var b=c.charCode?f.charCode:c.keyCode;var g=getFieldName(d);var a=fieldToSettingMap[g].dataType;if(a=="zip or postal code"){if((b>=97&&b<=122)||(b>=65&&b<=90)||(b>=48&&b<=57)||b==45||b==32){return true}else{return false}}else{if(a=="email"){if($.inArray(b,[34,39,40,41,42,47,61,91,93])!=-1){return false}}else{if(a=="url"){if($.inArray(b,[34,39,40,41,42,61,64,91,93])!=-1){return false}}else{if($.inArray(b,[34,39,40,41,42,47,61,64,91,93])!=-1){return false}}}}return true}function getXMLDocument(a){var b;try{b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a)}catch(c){if(window.DOMParser){var d=new DOMParser();b=d.parseFromString(a,"text/xml")}}return b}function HTMLDecode(a){return $("<div/>").html(a).text()}function getFieldNameByDataType(a){var b;for(ind in fieldNameElementArray){if(strEndsWith(ind,"__c")){if(strEndsWith(fieldNameElementArray[ind].className[0],"readonly")){className=fieldNameElementArray[ind].className[0];className=className.substring(0,className[0].indexOf("readonly")-1);b=fieldToSettingMap[className].dataType;if(a==b){return ind}}else{className=fieldNameElementArray[ind].className;if(className.indexOf(" ")!=-1){className=className.substr(0,className.indexOf(" "))}b=fieldToSettingMap[className].dataType;if(a==b){return ind}}}}return""}function strEndsWith(b,a){return b.match(a+"$")==a}function findDuplicates(b,a){makeCallFindDuplicate(b,a)}function makeCallFindDuplicate(f,c){var b=[];var d=[];var a={};var g={};if(typeof(c)!="undefined"&&c!=null&&c!=""){g.dataSourceConnectorName=fieldToSettingMap[c].dataSourceConnectorName;g.ruleSetName=fieldToSettingMap[c].ruleSetName;g.duplicateIdentificationRuleSubsetName=fieldToSettingMap[c].duplicateIDRuleSubsetName}else{g.ruleSetName=f.ruleSetName;g.duplicateIdentificationRuleSubsetName=f.duplicateIDRuleSubsetName;g.dataSourceConnectorName=f.dataSourceConnectorName}g.timeOutInSeconds="5";g.maximumRecordsReturned=MaximumRecordsReturned;for(ind in fieldNameElementArray){if(fieldNameElementArray[ind]!=null&&typeof(fieldNameElementArray[ind])!="undefined"&&fieldNameElementArray[ind].value!=null&&fieldNameElementArray[ind].value!=""){a[cleanseBCName+"."+ind]=fieldNameElementArray[ind].value}}var e=getDupFieldValueMapEnvelope(a,g,"findDuplicateRecords","searchCriteria");webserviceCall(e,parseFindDuplicate,f)}function parseFindDuplicate(c,e){var d;if(window.DOMParser){parser=new DOMParser();d=parser.parseFromString(c,"text/xml")}else{d=new ActiveXObject("Microsoft.XMLDOM");d.async=false;d.loadXML(c)}var a="";var b=new Array();if(d.getElementsByTagName("return")[0].childNodes.length>0){$(d).find("duplicateRecordSet").each(function(){$(this).find("duplicateRecordID").each(function(){b.push($(this).text())})});a=b.join(",");if(typeof displayAccounts=="function"){displayAccounts(a)}}}function setFieldValue(b,a){switch(b){case"state":if(_angular_scope===undefined){state_input=getBillingStateInputItem();state_input.value=a;if(getBillingStateInputItem().parentNode.className.toLowerCase()=="lookupinput"){country=getBillingCountryInputItemValue();if(_country_states[country]){for(i=0;i<_country_states[country].length;i++){if(_country_states[country][i].name.toLowerCase()==a.toLowerCase()){document.getElementById(state_input.id+"_lkid").value=_country_states[country][i].id;$(state_input).trigger("change");break}}}}}else{if(!_angular_scope.thisUserRegDataModel){_angular_scope.state=a}dqplus.setStateToScope(a)}break;case"city":if(_angular_scope===undefined){getBillingCityInputItem().value=a}else{if(_angular_scope.thisUserRegDataModel){_angular_scope.thisUserRegDataModel.companyCity=a}else{_angular_scope.city=a}}break;case"zip":if(_angular_scope===undefined){getBillingPostalcodeInputItem().value=a}else{if(_angular_scope.thisUserRegDataModel){_angular_scope.thisUserRegDataModel.companyZipcode=a}else{_angular_scope.zip=a}}break;case"street":if(_angular_scope===undefined){getBillingStreetInputItem().value=a}else{if(_angular_scope.thisUserRegDataModel){_angular_scope.thisUserRegDataModel.companyAddress1=a}else{_angular_scope.street=a}}break;case"firstname":if(_angular_scope===undefined){getFirstNameInputItem().value=a}else{if(_angular_scope.thisUserRegDataModel){_angular_scope.thisUserRegDataModel.firstName=a}else{_angular_scope.firstname=a}}break;case"lastname":if(_angular_scope===undefined){getLastNameInputItem().value=a}else{if(_angular_scope.thisUserRegDataModel){_angular_scope.thisUserRegDataModel.lastName=a}else{_angular_scope.lastname=a}}break;case"accountname":if(_angular_scope===undefined){getAccountNameInputItem().value=a}else{_angular_scope.accountname=a}break}}dqplus.setLongNameState=function(a,b){if(_country_states[b]){for(i=0;i<_country_states[b].length;i++){if(_country_states[b][i].code.toLowerCase()==a.toLowerCase()){return _country_states[b][i].name}}}return a};dqplus.findTranslatedState=function(a,b){b=b.toLowerCase();if(translated_states[b]!=undefined){if(translated_states[b][a]!=undefined){return translated_states[b][a]}}return a};dqplus.setStateToScope=function(b){var a;if(_angular_scope.thisUserRegDataModel){a=_angular_scope.companyCountryStateList}else{a=_angular_scope.states}if(a){for(key in a){var c=a[key];if(c.Name!=undefined&&c.Name.toLowerCase()==b.toLowerCase()){if(_angular_scope.thisUserRegDataModel){_angular_scope.thisUserRegDataModel.companyStateProvince=c}else{_angular_scope.$selectedstate=c}break}}}};dqplus.getInputValue=function(a){if(a.type=="text"){return a.value}else{if(a.tagName.toLowerCase()=="select"){return $(a).find("option:selected").text()}}};